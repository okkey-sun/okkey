<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>テスト結果</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            max-width: 800px;
            margin-top: 50px;
        }
        .card {
            margin-bottom: 20px;
        }
        .choice-item {
            padding: 8px 12px;
            border-radius: 5px;
            margin-bottom: 5px;
            border: 1px solid #dee2e6;
            background-color: #fff;
            display: flex;
            align-items: center;
        }
        .choice-item.selected {
            background-color: #e0f7fa; /* Light blue for selected */
            border-color: #00bcd4;
        }
        .choice-item.correct {
            background-color: #d4edda; /* Light green for correct */
            border-color: #28a745;
        }
        .choice-item.incorrect {
            background-color: #f8d7da; /* Light red for incorrect selected */
            border-color: #dc3545;
        }
        .choice-label {
            flex-grow: 1;
            padding-left: 5px; /* Small padding between icon and text */
        }
        .icon-container {
            width: 25px; /* Adjust as needed for icon size */
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 0; /* Prevent shrinking */
        }
        .status-icon {
            font-size: 1.2em;
            /* Removed margin-left as it's now handled by icon-container */
        }
        .status-icon.correct {
            color: #28a745;
        }
        .status-icon.incorrect {
            color: #dc3545;
        }
        .custom-rationale-bg,
        .custom-reference-bg {
            background-color: #f5f5f5;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="text-center mb-4">テスト結果</h2>

        <div class="alert alert-info text-center">
            <h3>{{ total }}問中 <span class="correct-answer">{{ score }}</span> 問正解！</h3>
        </div>

        {% for res in results %}
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">
                    問題 {{ loop.index }}
                    {% if res.is_correct %}
                        <span class="badge bg-success">正解</span>
                    {% else %}
                        <span class="badge bg-danger">不正解</span>
                    {% endif %}
                </h5>
                <p class="card-text">{{ res.question.question }}</p>

                                <div class="mb-3">

                                    {% set all_choices = [res.question.choice1, res.question.choice2, res.question.choice3, res.question.choice4] %}

                                    {% for choice_text in all_choices %}

                                        {% set current_choice_index = loop.index %}

                                        {% set is_selected = (current_choice_index == res.selected_choice_index) %}

                                        {% set is_correct_choice = (current_choice_index == res.correct_choice_index) %}

                

                                        <div class="choice-item 

                                            {% if is_selected and res.is_correct %}correct{% elif is_selected and not res.is_correct %}incorrect{% elif is_correct_choice and not is_selected %}correct{% endif %}"

                                            >

                                            <div class="icon-container">

                                            {% if is_selected and res.is_correct %}

                                                <span class="status-icon correct">✔</span>

                                            {% elif is_selected and not res.is_correct %}

                                                <span class="status-icon incorrect">✖</span>

                                            {% elif is_correct_choice %}

                                                <span class="status-icon correct">✔</span>

                                            {% endif %}

                                            </div>

                                            <span class="choice-label">{{ choice_text }}</span>

                                        </div>

                                    {% endfor %}

                                </div>

                                {% if res.question.rationale %}

                                <div class="custom-rationale-bg alert mt-3">

                                    <strong>解説:</strong><br>

                                    {{ res.question.rationale }}

                                </div>

                                {% endif %}

                                {% if res.question.reference %}

                                <div class="custom-reference-bg alert">

                                    <strong>参照URL:</strong><br>

                                    <a href="{{ res.question.reference }}" target="_blank">{{ res.question.reference }}</a>

                                </div>

                                {% endif %}

                
            </div>
        </div>
        {% endfor %}

        <div class="text-center">
            {% if test_type == 'practice' %}
                <a href="{{ url_for('practice') }}" class="btn btn-primary">もう一度テストする</a>
            {% else %}
                <a href="{{ url_for('section_test') }}" class="btn btn-primary">もう一度テストする</a>
            {% endif %}
            <br><br><a href="/home" class="btn btn-secondary">ホームに戻る</a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


